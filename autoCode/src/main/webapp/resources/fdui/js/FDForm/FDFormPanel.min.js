var FDFormPanel=function(a){this.options=FDLib.util.apply(this.getOptions(),a);this.controls=this.options.controls};FDFormPanel.prototype={getOptions:function(){return{controls:[],url:"",grid:null,win:null,crudUrl:null,onSubmit:null}},submit:function(f){var a=this.options.onSubmit;var e=true;if(a){e=a.call(this)}if(e){var d=this.getValues();var b=this.getUrl();var c=this;FDLib.ajax.request({url:b,params:d,success:function(h){if(FDLib.util.isFunction(f)){if(h.success){f(h)}else{var g=h.message;g=g+"<br>"+c.buildValidateError(h);FDWindow.alert(g)}}}})}},buildValidateError:function(a){if(a.messages&&a.messages.length>0){var b=a.messages;return'<span style="color:red;">'+b.join("<br>")+"</span>"}else{return""}},add:function(){this.setUrl(this.getCrudUrl().add);this.reset();this.getWin().setTitle("添加");this.getWin().show()},update:function(a){this.getWin().setTitle("修改");this.setUrl(this.getCrudUrl().update);this.reset();this.setValues(a);this.getWin().show()},del:function(b){var a=this;FDWindow.confirm("确定删除这条记录?",function(c){if(c){a.setUrl(a.getCrudUrl().del);a.setValues(b);a.submit(function(){a.getWin().close();a.getGrid().reload()})}})},save:function(){var a=this.validate();if(!a){return false}var b=this;this.submit(function(){b.getGrid().refresh();b.getWin().close()})},validate:function(){for(var b=0,a=this.controls.length;b<a;b++){if(!this.controls[b].validate()){return false}}return true},setUrl:function(a){this.options.url=a},getUrl:function(){return this.options.url},getCrudUrl:function(){return this.options.crudUrl},getWin:function(){return this.options.win},getGrid:function(){return this.options.grid},getControl:function(a){return FDLib.util.each(this.controls,function(b){if(b.getName()==a){return b}})},setValues:function(b){var a=FDLib.util;if(a.isObject(b)){a.each(this.controls,function(d){var c=b[d.getName()];if(c!=undefined){d.setValue(c)}})}},getValues:function(a){var b={};FDLib.util.each(this.controls,function(c){b[c.getName()]=c.getValue()});if(a){return b[a]}return b},setData:function(a){this.setValues(a)},getData:function(a){return this.getValues(a)},reset:function(){FDLib.util.each(this.controls,function(a){a.reset()})}};